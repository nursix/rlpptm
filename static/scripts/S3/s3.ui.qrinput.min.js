/*
 2021 (c) Sahana Software Foundation
 @license MIT
*/
(function(a,n){var h=0;a.widget("s3.qrInput",{options:{workerPath:null},_create:function(){this.id=h;h+=1;this.eventNamespace=".qrInput"},_init:function(){this.container=a(this.element).closest(".qrinput");this.scanButton=a(".qrscan-btn",this.container);this.options.workerPath&&(QrScanner.WORKER_PATH=this.options.workerPath);this.refresh()},_destroy:function(){var c=this.scanner,b=this.videoInput;c&&(c.destroy(),this.scanner=null);b&&(b.remove(),this.videoInput=null);a.Widget.prototype.destroy.call(this)},
refresh:function(){var c=a(this.element),b=this;this._unbindEvents();a(".error_wrapper",this.container).appendTo(this.container);b.scanButton.length&&QrScanner.hasCamera().then(function(d){var g=b.scanButton;if(d){g.prop("disabled",!1);var e;d=a('<div class="qrinput-scan">');var k=a('<div class="qrinput-success">').html('<i class="fa fa-check">').hide().appendTo(d),f=a("<video>").appendTo(d);f.css({width:"300",height:"300"});var l=d.dialog({title:"Scan QR Code",autoOpen:!1,modal:!0,classes:{"ui-dialog":"qrinput-dialog"},
close:function(){e&&(e.stop(),e.destroy(),e=null)}});g.on("click",function(){f.show();k.hide();l.dialog("open");e=new QrScanner(f.get(0),function(m){f.hide();k.show();c.val(m).trigger("change"+b.eventNamespace);setTimeout(function(){l.dialog("close")},1E3)},function(){});e.start()})}else g.prop("disabled",!0)});this._bindEvents()},_clearInput:function(){a(this.element).val("").trigger("change"+this.eventNamespace)},_bindEvents:function(){var c=a(this.element),b=this.eventNamespace,d=this;a(".clear-btn",
c.closest(".qrinput")).on("click"+b,function(){d._clearInput()});return!0},_unbindEvents:function(){var c=a(this.element),b=this.eventNamespace;a(".clear-btn",c.closest(".qrinput")).off(b);return!0}})})(jQuery);
