/*
 2015-2020 (c) Sahana Software Foundation
 @license MIT

 requires jQuery 1.9.1+
 requires jQuery UI 1.10 widget factory
*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(c,k,g){c instanceof String&&(c=String(c));for(var b=c.length,a=0;a<b;a++){var d=c[a];if(k.call(g,d,a,c))return{i:a,v:d}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(c,k,g){if(c==Array.prototype||c==Object.prototype)return c;c[k]=g.value;return c};$jscomp.getGlobal=function(c){c=["object"==typeof globalThis&&globalThis,c,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var k=0;k<c.length;++k){var g=c[k];if(g&&g.Math==Math)return g}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(c,k){var g=$jscomp.propertyToPolyfillSymbol[k];if(null==g)return c[k];g=c[g];return void 0!==g?g:c[k]};
$jscomp.polyfill=function(c,k,g,b){k&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(c,k,g,b):$jscomp.polyfillUnisolated(c,k,g,b))};$jscomp.polyfillUnisolated=function(c,k,g,b){g=$jscomp.global;c=c.split(".");for(b=0;b<c.length-1;b++){var a=c[b];if(!(a in g))return;g=g[a]}c=c[c.length-1];b=g[c];k=k(b);k!=b&&null!=k&&$jscomp.defineProperty(g,c,{configurable:!0,writable:!0,value:k})};
$jscomp.polyfillIsolated=function(c,k,g,b){var a=c.split(".");c=1===a.length;b=a[0];b=!c&&b in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var d=0;d<a.length-1;d++){var e=a[d];if(!(e in b))return;b=b[e]}a=a[a.length-1];g=$jscomp.IS_SYMBOL_NATIVE&&"es6"===g?b[a]:null;k=k(g);null!=k&&(c?$jscomp.defineProperty($jscomp.polyfills,a,{configurable:!0,writable:!0,value:k}):k!==g&&(void 0===$jscomp.propertyToPolyfillSymbol[a]&&($jscomp.propertyToPolyfillSymbol[a]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(a):
$jscomp.POLYFILL_PREFIX+a),a=$jscomp.propertyToPolyfillSymbol[a],$jscomp.defineProperty(b,a,{configurable:!0,writable:!0,value:k})))};$jscomp.polyfill("Array.prototype.find",function(c){return c?c:function(k,g){return $jscomp.findInternal(this,k,g).v}},"es6","es3");
(function(c,k){var g=0;c.widget("s3.groupedItems",{options:{ajaxURL:null,renderGroupHeaders:!1,totalsLabel:"TOTAL"},_create:function(){c(this.element);this.id=g;g+=1;this.eventNamespace=".groupeditems"},_init:function(){var b=c(this.element);this.widget_id=b.attr("id");this.items=b.find(".gi-data").first();this.refresh()},_destroy:function(){c.Widget.prototype.destroy.call(this)},refresh:function(){var b=c(this.element);b.find(".gi-throbber").show();this._unbindEvents();this.data||this._deserialize();
var a=this.data,d=b.find(".gi-table");a.e?(d.hide(),d.empty(),b.find(".gi-empty").show()):(b.find(".gi-empty").hide(),d.empty(),a=this._renderTable(a),d.append(a).show());this._bindEvents();b.find(".gi-throbber").css("visibility","hidden")},_renderTable:function(b){var a=c('<table class="groupeditems">');this._renderTableHeader(b).appendTo(a);this._renderGroup(a,b);this._renderTableFooter(b).appendTo(a);return a},_renderTableHeader:function(b){var a=c("<thead>"),d=c('<tr class="gi-column-headers">').appendTo(a),
e=b.c;b=b.l;for(var h,l=0,m=e.length;l<m;l++)h=b[e[l]],c("<th>").html(h).appendTo(d);return a},_renderTableFooter:function(b){var a=this.options,d=c("<tfoot>"),e=c('<tr class="gi-column-totals">'),h=b.t,l=!1;for(n in h){l=!0;break}if(l){b=b.c;for(var m=null,f=0,r=0,q=b.length;r<q;r++){if(!m){if(!h.hasOwnProperty(b[r])){f++;continue}1<f&&(m=c('<td class="gi-column-totals-label" colspan="'+f+'">'),c("<span> "+a.totalsLabel+"</span>").appendTo(m),m.appendTo(e))}var n=c("<td>").appendTo(e);(l=h[b[r]])&&
n.html(l)}e.appendTo(d)}return d},_renderGroup:function(b,a,d,e){"undefined"==typeof d&&(d=a);"undefined"==typeof e&&(e=0);this.options.renderGroupHeaders&&0<e&&this._renderGroupHeader(b,a,d,e);var h=d.d,l=d.i,m;if(h){var f=0;for(m=h.length;f<m;f++)this._renderGroup(b,a,h[f],e+1)}else if(l)for(f=0,m=l.length;f<m;f++)this._renderItem(b,a,l[f],e);0<e&&this._renderGroupFooter(b,a,d,e)},_renderGroupHeader:function(b,a,d,e){a=a.c;d=d.v;e=c('<tr class="gi-group-header gi-level-'+e+'">');c('<td colspan="'+
a.length+'">').html(d).appendTo(e);e.appendTo(b)},_renderGroupFooter:function(b,a,d,e){var h=this.options,l=d.t,m=!1;for(f in l){m=!0;break}a=a.c;d=d.v;e=c('<tr class="gi-group-footer gi-level-'+e+'">');if(!m&&!h.renderGroupHeaders)c('<td colspan="'+a.length+'">').html(d).appendTo(e),e.appendTo(b);else if(m){m=0;var f=null;for(var r,q,n=0,p=a.length;n<p;n++){if(!f){if(!l.hasOwnProperty(a[n])){m++;continue}1<m&&(f=c('<td class="gi-group-footer-label" colspan="'+m+'">'),h.renderGroupHeaders||f.html(d),
c('<span class="gi-group-footer-inline-label"> '+h.totalsLabel+"</span>").appendTo(f),f.appendTo(e))}q=c("<td>").appendTo(e);(r=l[a[n]])&&q.html(r)}e.appendTo(b)}},_renderItem:function(b,a,d,e){e=c('<tr class="gi-item gi-level-'+e+'">');a=a.c;for(var h,l,m=0,f=a.length;m<f;m++)l=c("<td>"),(h=d[a[m]])&&l.html(h),l.appendTo(e);e.appendTo(b)},reload:function(b,a,d){d="undefined"!=typeof d?d:!0;"undefined"==typeof a&&(a=this._getFilters());var e=this,h=!1;c(this.element).find(".gi-throbber").css("visibility",
"visible");if(b||a)h=this._updateAjaxURL(b,a);h||d?c.ajax({url:this.options.ajaxURL,dataType:"json"}).done(function(l){e.items.val(JSON.stringify(l));e.data=null;e.refresh()}).fail(function(l,m,f){msg="UNAUTHORIZED"==f?i18n.gis_requires_login:l.responseText;console.log(msg)}):e.refresh()},_getFilters:function(){var b=c("#"+this.widget_id+"-filter-form");try{return b.length?S3.search.getCurrentFilters(b.first()):null}catch(a){return null}},_updateAjaxURL:function(b,a){var d=this.options.ajaxURL;if(!d)return!1;
var e=d.split("?");if(1<e.length){var h=e[1];var l=h.split("&")}else l=[];var m=[];d=!1;if(b)for(var f in b)h=b[f],h=f+"="+h,d||-1!=c.inArray(h,l)||(d=!0),m.push(h);f={};h={};var r;if(a){var q=0;for(r=a.length;q<r;q++){var n=a[q];var p=n[0];n=n[1];null===n?f[p]||(h[p]=!0):(h[p]&&(h[p]=!1),n=p+"="+encodeURIComponent(n),f[p]?f[p].push(n):f[p]=[n])}}q=0;for(r=l.length;q<r;q++)n=l[q].split("="),1<n.length&&(p=decodeURIComponent(n[0]),n=decodeURIComponent(n[1]),h[p]?d=!0:f[p]?d||-1!=c.inArray(p+"="+n,
f[p])||(d=!0):b&&b.hasOwnProperty(p)||m.push(l[q]));for(p in f)for(q=0,r=f[p].length;q<r;q++)d||-1!=c.inArray(f[p][q],l)||(d=!0),m.push(f[p][q]);b=m.join("&");a=e[0];b&&(a=a+"?"+b);this.options.ajaxURL=a;return d},_serialize:function(){var b=this.items;if(b){var a="";this.data&&(a=JSON.stringify(this.data));b.val(a)}return a},_deserialize:function(){this.data={};var b=this.items;b&&(b=b.val())&&(this.data=JSON.parse(b));return this.data},_bindEvents:function(){var b=this;c(this.element).delegate(".gi-export",
"click"+this.eventNamespace,function(){var a=c(this).data("url"),d=b._getFilters();d&&(a=S3.search.filterURL(a,d));window.open(a)})},_unbindEvents:function(){c(this.element).undelegate(this.eventNamespace)}})})(jQuery);
